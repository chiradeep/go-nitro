# Go client for configuring Citrix ADC

## About
The [NITRO](https://developer-docs.citrix.com/projects/citrix-adc-nitro-api-reference/en/12.1/) API is the REST-like API to the Citrix ADC (aka NetScaler). This project provides a Golang SDK that can be used to make configuration API calls to a Citrix ADC.

## Versioning

The repository uses tags to identify which version of the NITRO API is used to generate the config packages.

The version scheme follows that of Citrix ADC versioning.

For example the tag v12.1.50.12 signifies that the [jsonconfig](./jsonconfig) files and the generated [config](./config) files
are taken from the same Citrix ADC version. In this instance it is Citrix ADC version 12.1 build 50.12 .

You can checkout a specific tag or download the corresponding release if you would like to use some 
version of the API other than the one pointed to by the master branch.

## Usage
Import the SDK from github.com/chiradeep/go-nitro/netscaler. Config objects are available at github.com/chiradeep/go-nitro/config.
Instantiate a client using `NewNitroClient`. To initialize the client from environment variables:

```
export NS_URL=http://<ip-address>
export NS_LOGIN=<netscaler-username>
export NS_PASSWORD=<netscaler-password>
```

Config object types can be passed in as strings ("lbvserver"), or looked up from `netscaler.<config object type>.Type()`
The general pattern for NetScaler config objects is some combination of  `AddResource`, `UpdateResource`, `BindResource`, `UnbindResource` and `DeleteResource`. See the [NITRO REST docs](https://docs.citrix.com/en-us/netscaler/11-1/nitro-api/nitro-rest/nitro-rest-general.html) for more information.

## Example

### Example 1: Create Nitro Client and Add LB Vserver
```
package main

import (
        "github.com/chiradeep/go-nitro/config/lb"
        "github.com/chiradeep/go-nitro/netscaler"
)

function main() {
        client, _ := netscaler.NewNitroClientFromEnv()
        lb1 := lb.Lbvserver{
                Name:        "sample_lb",
                Ipv46:       "10.71.136.50",
                Lbmethod:    "ROUNDROBIN",
                Servicetype: "HTTP",
                Port:        8000,
        }
        result, err := client.AddResource(netscaler.Lbvserver.Type(), "sample_lb", &lb1)
        if err == nil {
            client.SaveConfig()
        }
}

```

### Example 2: Create Client with Password Encryption Enabled and Add LB Vserver

Sensitive information such as password is stored in Nitro client. By default, this password will be in clear text in Nitroparams structure.
It is recommended to store this password in encrypted fashion while creating Nitro client.
Go-nitro provides support for AES GCM encryption and cryptographic key for this encryption is derived using PBKDF2. 

In below example, 32-byte key is derived using 8-byte cryptographic salt and SHA256 hash function in 1000 iterations.

```
package main

import (
	"crypto/rand"
	"crypto/sha256"
        "github.com/chiradeep/go-nitro/config/lb"
        "github.com/chiradeep/go-nitro/netscaler"
)

func main() {

	masterkey := make([]byte, 32)
	rand.Read(masterkey)
	keyspec :=  netscaler.NewKeyspec(masterkey, 8, 1000, 32, sha256.New)
	client, _ = netscaler.NewNitroClientFromParams(netscaler.NitroParams{Url: os.Getenv("NS_URL"), Username: os.Getenv("NS_LOGIN"), Password: os.Getenv("NS_PASSWORD"), Keyspec: keyspec})
	lb1 := lb.Lbvserver{
		Name:        "sample_lb",
		Ipv46:       "10.71.136.50",
		Lbmethod:    "ROUNDROBIN",
		Servicetype: "HTTP",
		Port:        8000,
	}
        result, err := client.AddResource(netscaler.Lbvserver.Type(), "sample_lb", &lb1)
        if err == nil {
            client.SaveConfig()
        }
}

```


## Building
The `structs` for the config objects under `config/` are generated from JSON declarations in `jsonconfig`. The JSON itself is generated by reverse engineering the official NITRO Java SDK (see [https://github.com/chiradeep/json-nitro](https://github.com/chiradeep/json-nitro)).  To build the SDK, use `make build`. To regenerate the Go structs from JSON, use `make generate`

### Unit Tests
The unit tests are invoked with `make unit`. Note that they are actually functional tests and need a running NetScaler. The tests also need the environment variables `NS_URL`, `NS_LOGIN` and `NS_PASSWORD` to be set.

### Using HTTPS
If you specify `https` in the URL then the client will use HTTPS. By default it will verify the presented certificate. If you want to use the default or self-signed certificates without verification, specify `sslVerify=false` in the constructor `NewNitroClientFromParams` or set the environment variable `NS_SSLVERIFY` to `false` and use the `NewNitroClientFromEnv` constructor

## TODO
Some [REST operations](https://developer-docs.citrix.com/projects/netscaler-nitro-api/en/12.0/performing-netscaler-resource-operations/) are not yet supported:

* Pagination & filtering
* Count 
* Unset
* Rename
* Idempotent Add/Update
* SSL Certificate operations:
  * Link/Unlink
  * Import 

`
